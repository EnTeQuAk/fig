<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>Fig by orchardup</title>

    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/pygment_trac.css">
    <script src="javascripts/scale.fix.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="wrapper">
      <header>
        <h1 class="header">Fig</h1>
        <p class="header">Punctual, lightweight development environments using Docker</p>

        <ul>
          <li class="download"><a class="buttons" href="https://github.com/orchardup/fig/zipball/master">Download ZIP</a></li>
          <li class="download"><a class="buttons" href="https://github.com/orchardup/fig/tarball/master">Download TAR</a></li>
          <li><a class="buttons github" href="https://github.com/orchardup/fig">View On GitHub</a></li>
        </ul>

        <p class="header">This project is maintained by <a class="header name" href="https://github.com/orchardup">orchardup</a></p>


      </header>
      <section>
        <h1>
<a name="fig" class="anchor" href="#fig"><span class="octicon octicon-link"></span></a>Fig</h1>

<p>Punctual, lightweight development environments using Docker.</p>

<p>Fig is tool for defining and running isolated application environments. It uses simple, version-controllable YAML configuration files that look something like this:</p>

<div class="highlight highlight-yaml"><pre><span class="l-Scalar-Plain">web</span><span class="p-Indicator">:</span>
  <span class="l-Scalar-Plain">build</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">.</span>
  <span class="l-Scalar-Plain">links</span><span class="p-Indicator">:</span>
   <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">db</span>
  <span class="l-Scalar-Plain">ports</span><span class="p-Indicator">:</span>
   <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">8000:8000</span>
<span class="l-Scalar-Plain">db</span><span class="p-Indicator">:</span>
  <span class="l-Scalar-Plain">image</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">orchardup/postgresql</span>
</pre></div>

<h2>
<a name="installing" class="anchor" href="#installing"><span class="octicon octicon-link"></span></a>Installing</h2>

<div class="highlight highlight-bash"><pre><span class="nv">$ </span>sudo pip install fig
</pre></div>

<h2>
<a name="defining-your-app" class="anchor" href="#defining-your-app"><span class="octicon octicon-link"></span></a>Defining your app</h2>

<p>Put a <code>fig.yml</code> in your app's directory. Each top-level key defines a "service", such as a web app, database or cache. For each service, Fig will start a Docker container, so at minimum it needs to know what image to use.</p>

<p>The simplest way to get started is to just give it an image name:</p>

<div class="highlight highlight-yaml"><pre><span class="l-Scalar-Plain">db</span><span class="p-Indicator">:</span>
  <span class="l-Scalar-Plain">image</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">orchardup/postgresql</span>
</pre></div>

<p>You've now given Fig the minimal amount of configuration it needs to run:</p>

<div class="highlight highlight-bash"><pre><span class="nv">$ </span>fig up
Pulling image orchardup/postgresql...
Starting myapp_db_1...
myapp_db_1 is running at 127.0.0.1:45678
&lt;...output from postgresql server...&gt;
</pre></div>

<p>For each service you've defined, Fig will start a Docker container with the specified image, building or pulling it if necessary. You now have a PostgreSQL server running at <code>127.0.0.1:45678</code>.</p>

<p>By default, <code>fig up</code> will run until each container has shut down, and relay their output to the terminal. To run in the background instead, pass the <code>-d</code> flag:</p>

<div class="highlight highlight-bash"><pre><span class="nv">$ </span>fig up -d
Starting myapp_db_1... <span class="k">done</span>
myapp_db_1 is running at 127.0.0.1:45678

<span class="nv">$ </span>fig ps
Name         State  Ports
------------------------------------
myapp_db_1   Up     5432-&gt;45678/tcp
</pre></div>

<h3>
<a name="building-services" class="anchor" href="#building-services"><span class="octicon octicon-link"></span></a>Building services</h3>

<p>Fig can automatically build images for you if your service specifies a directory with a <code>Dockerfile</code> in it (or a Git URL, as per the <code>docker build</code> command).</p>

<p>This example will build an image with <code>app.py</code> inside it:</p>

<h4>
<a name="apppy" class="anchor" href="#apppy"><span class="octicon octicon-link"></span></a>app.py</h4>

<div class="highlight highlight-python"><pre><span class="k">print</span> <span class="s">"Hello world!"</span>
</pre></div>

<h4>
<a name="figyml" class="anchor" href="#figyml"><span class="octicon octicon-link"></span></a>fig.yml</h4>

<div class="highlight highlight-yaml"><pre><span class="l-Scalar-Plain">web</span><span class="p-Indicator">:</span>
  <span class="l-Scalar-Plain">build</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">.</span>
</pre></div>

<h4>
<a name="dockerfile" class="anchor" href="#dockerfile"><span class="octicon octicon-link"></span></a>Dockerfile</h4>

<pre><code>FROM ubuntu:12.04
RUN apt-get install python
ADD . /opt
WORKDIR /opt
CMD python app.py
</code></pre>

<h3>
<a name="getting-your-code-in" class="anchor" href="#getting-your-code-in"><span class="octicon octicon-link"></span></a>Getting your code in</h3>

<p>If you want to work on an application being run by Fig, you probably don't want to have to rebuild your image every time you make a change. To solve this, you can share the directory with the container using a volume so the changes are reflected immediately:</p>

<div class="highlight highlight-yaml"><pre><span class="l-Scalar-Plain">web</span><span class="p-Indicator">:</span>
  <span class="l-Scalar-Plain">build</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">.</span>
  <span class="l-Scalar-Plain">volumes</span><span class="p-Indicator">:</span>
   <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">.:/opt</span>
</pre></div>

<h3>
<a name="communicating-between-containers" class="anchor" href="#communicating-between-containers"><span class="octicon octicon-link"></span></a>Communicating between containers</h3>

<p>Your web app will probably need to talk to your database. You can use <a href="http://docs.docker.io/en/latest/use/port_redirection/#linking-a-container">Docker links</a> to enable containers to communicate, pass in the right IP address and port via environment variables:</p>

<div class="highlight highlight-yaml"><pre><span class="l-Scalar-Plain">db</span><span class="p-Indicator">:</span>
  <span class="l-Scalar-Plain">image</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">orchardup/postgresql</span>

<span class="l-Scalar-Plain">web</span><span class="p-Indicator">:</span>
  <span class="l-Scalar-Plain">build</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">.</span>
  <span class="l-Scalar-Plain">links</span><span class="p-Indicator">:</span>
   <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">db</span>
</pre></div>

<p>This will pass an environment variable called <code>MYAPP_DB_1_PORT</code> into the web container, whose value will look like <code>tcp://172.17.0.4:45678</code>. Your web app's code can use that to connect to the database. To see all of the environment variables available, run <code>env</code> inside a container:</p>

<div class="highlight highlight-bash"><pre><span class="nv">$ </span>fig up -d db
<span class="nv">$ </span>fig run web env
</pre></div>

<h3>
<a name="container-configuration-options" class="anchor" href="#container-configuration-options"><span class="octicon octicon-link"></span></a>Container configuration options</h3>

<p>You can pass extra configuration options to a container, much like with <code>docker run</code>:</p>

<div class="highlight highlight-yaml"><pre><span class="l-Scalar-Plain">web</span><span class="p-Indicator">:</span>
  <span class="l-Scalar-Plain">build</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">.</span>

  <span class="l-Scalar-Plain">-- override the default command</span>
  <span class="l-Scalar-Plain">command</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">bundle exec thin -p 3000</span>

  <span class="l-Scalar-Plain">-- expose ports, optionally specifying both host and container ports (a random host port will be chosen otherwise)</span>
  <span class="l-Scalar-Plain">ports</span><span class="p-Indicator">:</span>
   <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">3000</span>
   <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">8000:8000</span>

  <span class="l-Scalar-Plain">-- map volumes</span>
  <span class="l-Scalar-Plain">volumes</span><span class="p-Indicator">:</span>
   <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">cache/:/tmp/cache</span>

  <span class="l-Scalar-Plain">-- add environment variables</span>
  <span class="l-Scalar-Plain">environment</span><span class="p-Indicator">:</span>
   <span class="l-Scalar-Plain">RACK_ENV</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">development</span>
</pre></div>

<h2>
<a name="running-a-one-off-command" class="anchor" href="#running-a-one-off-command"><span class="octicon octicon-link"></span></a>Running a one-off command</h2>

<p>If you want to run a management command, use <code>fig run</code> to start a one-off container:</p>

<div class="highlight highlight-bash"><pre><span class="nv">$ </span>fig run db createdb myapp_development
<span class="nv">$ </span>fig run web rake db:migrate
<span class="nv">$ </span>fig run web bash
</pre></div>
      </section>
      <footer>
        <p><small>Hosted on <a href="http://pages.github.com">GitHub Pages</a> using the Dinky theme</small></p>
      </footer>
    </div>
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->
		
  </body>
</html>
